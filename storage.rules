rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Landing media: public read (for site display), only admin write
    match /landing/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    // Content (posts/media): read allowed for anyone with the download URL (used in <img>/<video>; browser does not send auth).
    // Write remains admin-only. Download URLs are unguessable so link-sharing is safe.
    match /content/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    // User avatars: users can read/write own folder only
    match /avatars/{userId}/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    // DM attachments: images/videos in direct messages; authenticated read/write (conversation access enforced in Firestore)
    match /dm-attachments/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}
